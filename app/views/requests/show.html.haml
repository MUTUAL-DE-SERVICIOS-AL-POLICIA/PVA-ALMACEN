- unless is_pdf?
  .page-header{data: {action: 'request'}}
    .pull-right
      - if @request.status == 'initiation'
        = button_tag class: 'btn btn-primary buttonRequest', id: "btn_edit_request" do
          %span.glyphicon.glyphicon-edit
          Editar cantidad
      = link_to request_path(status: 'initiation', format: :pdf), class: 'btn btn-info' do
        %span.glyphicon.glyphicon-print
        Imprimir Solicitud
      - if @request.status == 'delivered'
        = link_to request_path(status: 'delivered', format: :pdf), class: 'btn btn-success' do
          %span.glyphicon.glyphicon-print
          Imprimir Entrega
      - if @request.status == 'pending'
        = button_tag class: 'btn btn-success buttonRequest', id: 'btn_deliver_request' do
          %span.glyphicon.glyphicon-shopping-cart
          Entregar producto
      = render 'dropdown', status: @request.status

    %h2
      Solicitud de Material
      %span#request_id{data: {id: @request.id}}
        - if @request.nro_solicitud != 0 && @request.nro_solicitud.present?
          Nro. #{@request.nro_solicitud}

    #request-urls{data: {'request-id' => request_path('{id}'), 'subarticles-articles' => articles_subarticles_path(format: :json), 'get-subarticles' => get_subarticles_subarticles_path(format: :json, q: '%QUERY'), 'users-id' => user_path('{id}', format: :json)}}

#request.row
  .col-md-12
    - if is_pdf?
      %h4
        %span.text-muted Nro de solicitud:
        = @request.nro_solicitud
    - unless is_pdf?
      %h4
        %span.text-muted Estado:
        = t("requests.title.status.#{@request.status}")
    %h4
      %span.text-muted Entregado por:
      = @request.admin_name
    %h4
      %span.text-muted Solicitado por:
      = @request.user_name
    %h4
      %span.text-muted Cargo:
      = @request.user_title
    %h4
      %span.text-muted Fecha de solicitud:
      = I18n.l(@request.created_at, format: :version)
    - @status_pdf = @request.status unless is_pdf?
    - if @status_pdf == 'delivered'
      %h4
        %span.text-muted Fecha de entrega:
        = I18n.l(@request.delivery_date, format: :version)

    #barcode

    .selected-assets
      #table_request
        - if is_pdf?
          - title = 'SOLICITUD DE MATERIALES'
          - if @status_pdf == 'delivered'
            - title = 'PEDIDO DE MATERIAL'
          %h3.text-center.proceeding-title= title
        %table.table.table-bordered.table-condensed{ class: "#{is_pdf? ? 'margen' : 'table-striped'}" }
          %thead
            %tr
              - unless is_pdf?
                %th Código Barras
              %th Código
              %th Unidad
              %th Descripción
              - if is_pdf?
                %th.text-center Cantidad
              - else
                %th.text-center Cantidad solicitada
                - if @request.status == 'pending'
                  %th Cantidad a entregar
                - if %w(pending delivered).include?(@request.status)
                  %th.amount_delivered.text-center Cantidad entregada
                - if @request.status == 'pending'
                  %th.delivered
          %tbody
            - @request.subarticle_requests.each do |s_request|
              - if s_request.amount_delivered != 0
                %tr{ id: s_request.id }
                  - unless is_pdf?
                    %td= s_request.subarticle_barcode
                  %td= s_request.subarticle_code
                  %td= s_request.subarticle_unit
                  %td{title: s_request.subarticle_barcode}
                    = s_request.subarticle_description
                  - if is_pdf?
                    %td.text-center
                      = @status_pdf == 'initiation' ? s_request.amount : s_request.total_delivered
                  - else
                    %td.text-center= s_request.amount
                    - if @request.status == 'pending'
                      %td.col-md-2.text-center= s_request.amount_delivered
                    - if %w(pending delivered).include?(@request.status)
                      %td.amount_delivered.text-center= s_request.total_delivered
                    - if @request.status == 'pending'
                      %td.delivered
                        %span.glyphicon{ class: "#{'glyphicon-ok' if s_request.total_delivered == s_request.amount_delivered}" }
        = fecha_impresion if is_pdf?
        .buttons-actions.text-center

    - if is_pdf?
      %table{ style: 'width: 100%' }
        %tr
          %td.text-center.firma-funcionario
            _______________________
            %p= @status_pdf == 'initiation' ? 'Solicitante' : 'Entregado por'
          - if @status_pdf == 'delivered'
            %td.text-center.firma-funcionario
              _______________________
              %p V.° B.°
            %td.text-center.firma-funcionario
              _______________________
              %p Recibí conforme
        %tr
          %td.text-center.firma-funcionario
          - if @status_pdf == 'delivered'
            %td.text-center.firma-funcionario
              _______________________
              %p V.° B.° Inmediato superior
            %td.text-center.firma-funcionario

= render 'material'
